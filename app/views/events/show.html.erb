<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=AIzaSyA2CUo-V9LEi2YuJvh6F_Sf7NkmpXnC4yE"
      type="text/javascript"></script>

<% map_url = "http://maps.googleapis.com/maps/api/staticmap?zoom=8&size=275x190&maptype=roadmap&markers=color:red%7Clabel:X%7C"+@event.location.latitude+","+@event.location.longitude+"&sensor=false" %>
<% content_for :sidebar do %>
  <%= render "sidebars/newsletter_signup" %>
<% end %>

<% if signed_in?%>
    <% if current_user.roles.any? {|role| role.name == "superuser" or role.name == "admin" } %>
      <%= link_to 'Edit', edit_event_path(@event) %> | <%= link_to 'Back', events_path %>
    <% end %>
<% end %>

<div class="date-graphic large">
    <% if @event.start.strftime("%b %d" ) == @event.end.strftime("%b %d") %>
    <div class="calendar-ii large">
       <div class="calendar_year-ii"><%= @event.start.strftime("%Y") %></div>
      <div class="calendar_month-ii large"><%= @event.start.strftime("%b") %></div>
      <div class="calendar_day-ii"><%= @event.start.strftime("%A") %></div>
      <div class="calendar_date-ii large"><%= @event.start.strftime("%d") %></div>
    </div>
    <% else %>
    <div class="calendar-ii large">
      <div class="calendar_year-ii"><%= @event.start.strftime("%Y") %></div>
      <div class="calendar_month-ii large"><%= @event.start.strftime("%b") %></div>
      <div class="calendar_day-ii"><%= @event.start.strftime("%A") %></div>
      <div class="calendar_date-ii large"><%= @event.start.strftime("%d") %></div>
    </div>
    <span style="float: left; font-size: 1em;margin: 4em 1em;">&#8211; </span>
    <div class="calendar-ii large">
      <div class="calendar_year-ii"><%= @event.end.strftime("%Y") %></div>
      <div class="calendar_month-ii large"><%= @event.end.strftime("%b") %></div>
      <div class="calendar_day-ii"><%= @event.end.strftime("%A") %></div>
      <div class="calendar_date-ii large"><%= @event.end.strftime("%d") %></div>
    </div>
    <% end %>
</div>
<h1><%= @event.title %></h1>
<% if @event.event_statuses_id == 2 %> <span class="error" style="display: inline;"><strong>--Tentative</strong></span><% end %>
<p><strong>When:</strong>
<% if @event.start.strftime("%b %d" ) == @event.end.strftime("%b %d") %>
  <%= @event.start.strftime("%b %d, %Y | %H:%M %p") %> - <%= @event.end.strftime("%H:%M %p") %></p>
<% else %>
  <% if @event.start.strftime("%b") == @event.end.strftime("%b") %>
    <%= @event.start.strftime("%b %d") %>-<%= @event.end.strftime("%d, %Y") %>
  <% else %>
    <%= @event.start.strftime("%b %d") %>-<%= @event.end.strftime("%b %d, %Y") %>
  <% end %>
<% end %>

<p><strong>What:</strong> <%= @event.event_type.title%></p>

  <% if @event.location.latitude? %>
    <div style="float: right; border: 1px solid #ccc; margin: 0 0 1em 1em;"><%= link_to image_tag(map_url), "http://maps.google.com/maps?q="+@event.location.latitude+",+"+@event.location.longitude, :target => "_blank" %></div>
  <% end %>
  
<p><strong>Where:</strong> <%= @event.location.short_name %> - <%= @event.location.city %>, <%= @event.location.state %></p>

<p><strong>Rides?:</strong> <% if @event.rides_available? %>Yes - Rides are available! <a href="/living_flight_history_experience">Learn more</a><% else %>Rides not available at this event.<% end %></p>


<% if @event.URL? %>
<p>
  <strong>Website:</strong>
  <%= link_to @event.URL, @event.URL, :target => "_blank" %>
</p>
<% end %>

<% if @event.contact_info? %>
<p>
  <strong>Contact info:</strong>
  <%= @event.contact_info %>
</p>
<% end %>

<% if @event.graphic_address? %>
  <div class="event_graphic"><%= image_tag(@event.graphic_address) %></div>
<% end %>

<% if @event.details? %>
  <p><%= simple_format(@event.details) %></p>
<% end %>
  
<div style="clear: both;"></div>
<hr />

<% if @event.flight_roster == true  %>

<% if current_user %>

<h2>Members Info:</h2>

<% if !@event.trip.blank? %>

<table>
  <tr>
    <th colspan="2">Trip Details:</th>
  </tr>
  <tr class="odd-row">
    <td width="150">Crew arrival:</td>
    <% if !@event.trip.crew_arrival.blank? %>
      <td><strong><%= @event.trip.crew_arrival.strftime("%b %d - %H:%M") %></strong></td>
    <% else %>
      <td><strong>n/a</strong></td>
    <% end %>
  </tr>
  <tr class="even-row">
    <td>Tug time:</td>
    <% if !@event.trip.tug_time.nil? %>
      <td><strong><%= @event.trip.tug_time.strftime("%b %d - %H:%M") %></strong></td>
    <% else %>
      <td><strong>n/a</strong></td>
    <% end %>
  </tr>
  <tr class="odd-row">
    <td>Wheels up:</td>
    <td><strong><%= @event.trip.wheels_up.strftime("%b %d - %H:%M") %></strong></td>
  </tr>
  <tr class="even-row">
    <td>Destination ETA:</td>
    <% if !@event.trip.destination_eta.nil? %>
      <td><strong><%= @event.trip.destination_eta.strftime("%b %d - %H:%M") %></strong></td>
    <% else %>
      <td><strong>n/a</strong></td>
    <% end %>
  </tr>
  <tr class="odd-row">
    <td>Return ETA:</td>
    <% if !@event.trip.return_eta.nil? %>
      <td><strong><%= @event.trip.return_eta.strftime("%b %d - %H:%M") %></strong></td>
    <% else %>
      <td><strong>n/a</strong></td>
    <% end %>
  </tr>
  <tr class="even-row">
    <td>Notes:</td>
    <td><%= @event.trip.notes %></td>
  </tr>
</table>
<% else %>
<p>No trip details yet...</p>
<% end %>

<% if signed_in?%>
    <% if current_user.roles.any? {|role| role.name == "superuser" or role.name == "admin" } %>
<% if !@event.trip.blank? %>
  <%= link_to 'Edit Trip', edit_trip_path(@event.trip) %>
<% else %>
  <%= link_to 'Add Trip Details', new_trip_path(:event_id => @event) %>
<% end %>
<% end %>
<% end %>

<div class="signup_box">
<strong>Put me on the List for this airshow:</strong>
  <% if current_user.roles.any? {|role| role.name == "superuser" or role.name == "member"} %>
    <div class="signup_buttons">
      <%= button_to 'Definite', {:controller => :event_signups, :action => :signup, :member_id => current_user.member, :event_id => @event.id, :commitment_level => 'Definite' } %>
      <%= button_to 'Maybe',    {:controller => :event_signups, :action => :signup, :member_id => current_user.member, :event_id => @event.id, :commitment_level => 'Maybe' } %>
    </div>
  <% end %>
<span style="font-style: italic;font-size:0.85em;">Your name will be entered on the list below, you can change your commitment or remove yourself at any time. Signing up only indicates your availability and desire to participate. Final roster at discretion of pilots.</em>
</div>

<table>
  <tr>
    <th>Name<br />Col. No.</th>
    <th>Commitment</th>
    <th>Sign-up Date (UTC)</th>
  </tr>

<% @event.event_signups.ordered.each do |event_signup| %>
  <tr class="<%= cycle('odd-row', 'even-row') %>">
    <td><%= event_signup.member.last_name %>, <%= event_signup.member.first_name %><br/>
    <%= event_signup.member.caf_col_no %></td>
    <td><%= event_signup.commitment_level %>
      <% if event_signup.member.user == current_user %>
        <span style="font-size: 0.75em;"><%= link_to "[change]", edit_signup_path(event_signup) %></span>     
      <% end %>
    </td>
    <td><%= event_signup.created_at.strftime("%b %d, %Y %H:%M %p") %></td>
  </tr>
<% end %>
</table>
<% end %>
<% end %>

<% if @event.rsvp == true  %>
<% if current_user %>

<div class="signup_box">
<strong>RSVP for this event:</strong>
  <% if current_user.roles.any? {|role| role.name == "superuser" or role.name == "member"} %>
    <div class="signup_buttons">
      <%= button_to 'Yes', {:controller => :attendances, :action => :signup, :member_id => current_user.member, :event_id => @event.id, :commitment_level => 'Definite'  } %>
      <%= button_to 'Maybe', {:controller => :attendances, :action => :signup, :member_id => current_user.member, :event_id => @event.id, :commitment_level => 'Maybe'  } %>
    </div>
  <% end %>
<span style="font-style: italic;font-size:0.85em;">Your name will be entered on the list below, you can remove yourself at any time.</em>
</div>

<p>Total RSVPs: <%= @event.attendances.size %> - Definite: <%= @event.attendances.definite.size %>
<% if @event.attendances.maybe.size.to_i > 0 %>
  , Maybe: <%= @event.attendances.maybe.size %>
<% end %>
<% if @event.attendances.canceled.size.to_i > 0 %>
  , Cancelations: <%= @event.attendances.canceled.size %>
<% end %>
</p>

<table>
  <tr>
    <th>Name<br />Col. No.</th>
    <th>Commitment</th>
    <th>Sign-up Date (UTC)</th>
  </tr>

<% @event.attendances.ordered.each do |attendance| %>
  <tr class="<%= cycle('odd-row', 'even-row') %>">
    <td><%= attendance.member.last_name %>, <%= attendance.member.first_name %><br />
    <%= attendance.member.caf_col_no %></td>
    <td><%= attendance.commitment_level %>
      <% if attendance.member.user == current_user %>
        <span style="font-size: 0.75em;"><%= link_to "[change]", edit_rsvp_path(attendance) %></span>     
      <% end %>
    </td>
    <td><%= attendance.created_at.strftime("%b %d, %Y %H:%M %p") %></td>
  </tr>
<% end %>
</table>

<% end %>
<% end %>
